<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <audio id="spinSound" src="spin.mp3"></audio>
  <audio id="winSound" src="win.mp3"></audio>

  <div style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <h2>üé° ‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h2>

<textarea id="nameInput" rows="6" cols="20">
Ned
Robret
Jaime
Cataly
Jorah
Cersei
</textarea><br>

<canvas id="wheel" width="300" height="300"></canvas>

<div id="result" style="margin-top:15px;font-size:20px;font-weight:bold;"></div>
</div>

<script>
/* ================== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πá‡∏≠‡∏Å ================== */
const LOCK_INDEX = 1;
/* =============================================== */

const spinSound = document.getElementById("spinSound");
const winSound  = document.getElementById("winSound");

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const cx = canvas.width / 2;
const cy = canvas.height / 2;
const outerR = canvas.width / 2;
const innerR = 55;

const nameInput = document.getElementById("nameInput");

let names = [];
let angle = 0;
let spinning = false;

/* üëá ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å */
let clickCount = 0;
let clickTimer = null;
const DOUBLE_CLICK_DELAY = 350;

/* ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠ */
function loadNames() {
  names = nameInput.value.split("\n").map(s => s.trim()).filter(Boolean);
}

/* ‡∏ß‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if (!names.length) return;
  drawWheel();
  drawArrow();
  drawCenterButton();
}

/* ‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏•‡πâ‡∏≠ */
function drawWheel() {
  const slice = Math.PI * 2 / names.length;
  for (let i = 0; i < names.length; i++) {
    const start = angle + i * slice;
    const end = start + slice;
    ctx.beginPath();
    ctx.arc(cx, cy, outerR - 5, start, end);
    ctx.arc(cx, cy, innerR, end, start, true);
    ctx.closePath();
    ctx.fillStyle = `hsl(${i*360/names.length},70%,70%)`;
    ctx.fill();

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(start + slice/2);
    ctx.textAlign = "right";
    ctx.font = "bold 20px Arial";
    ctx.fillStyle = "#000";
    ctx.fillText(names[i], outerR - 20, 6);
    ctx.restore();
  }
}

/* ‡∏•‡∏π‡∏Å‡∏®‡∏£ */
function drawArrow() {
  ctx.fillStyle = "#fff";
  ctx.strokeStyle = "#ccc";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(cx, 24);
  ctx.lineTo(cx - 22, 6);
  ctx.lineTo(cx + 22, 6);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();
}

/* ‡∏õ‡∏∏‡πà‡∏° START */
function drawCenterButton() {
  ctx.beginPath();
  ctx.arc(cx, cy, innerR - 5, 0, Math.PI * 2);
  ctx.fillStyle = "#fff";
  ctx.fill();
  ctx.fillStyle = "#5aa9e6";
  ctx.font = "bold 22px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("START", cx, cy);
}

/* ‡∏Ñ‡∏•‡∏¥‡∏Å START */
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left - cx;
  const y = e.clientY - rect.top - cy;
  if (Math.sqrt(x*x + y*y) <= innerR) handleStartClick();
});

/* üëá ‡∏ï‡∏£‡∏ß‡∏à 1 ‡∏Ñ‡∏•‡∏¥‡∏Å / 2 ‡∏Ñ‡∏•‡∏¥‡∏Å */
function handleStartClick() {
  if (spinning) return;
  clickCount++;
  if (clickTimer) clearTimeout(clickTimer);

  clickTimer = setTimeout(() => {
    if (clickCount === 1) startSpin("LOCK");
    else startSpin("RANDOM");

    clickCount = 0;
    clickTimer = null;
  }, DOUBLE_CLICK_DELAY);
}

/* ‡∏´‡∏°‡∏∏‡∏ô */
function startSpin(mode) {
  loadNames();
  if (!names.length) return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô");

  document.getElementById("result").textContent = "";

  spinSound.currentTime = 0;
  spinSound.play();
  winSound.currentTime = 0;
  winSound.play();
  winSound.pause();

  const slice = Math.PI * 2 / names.length;
  const spins = Math.floor(Math.random() * 40) + 40;

  const winIndex = (mode === "LOCK")
    ? LOCK_INDEX
    : Math.floor(Math.random() * names.length);

  const target =
    Math.PI * 2 * spins
    - Math.PI / 2
    - winIndex * slice
    - slice / 2;

  const start = angle;
  const startTime = performance.now();
  const duration = 9000;
  spinning = true;

  function animate(t) {
    const p = Math.min((t - startTime) / duration, 1);
    const ease = 1 - Math.pow(1 - p, 3);
    angle = start + (target - start) * ease;
    draw();

    if (p < 1) requestAnimationFrame(animate);
    else {
      spinning = false;
      spinSound.pause();
      winSound.play();
      document.getElementById("result").textContent =
        "üéØ ‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠: " + names[winIndex];
    }
  }
  requestAnimationFrame(animate);
}

/* init */
loadNames();
draw();
nameInput.addEventListener("input", () => {
  if (!spinning) {
    loadNames();
    draw();
  }
});
</script>
</body>
</html>






